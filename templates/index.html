<html>
    <head>
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vue-cookies@1.7.0/vue-cookies.min.js"></script>
        
        <!-- <script src="{{ url_for('static', filename = 'sw.js') }}"></script> -->
        <title>PictoALPH</title>

        <!-- Basic declarations and Meta descriptions -->
        <meta charset="utf-8">
        <!-- <meta name="viewport"    content="width=device-width, initial-scale=1, shrink-to-fit=no"> -->
        <meta name="description" content="Chat.">

        <!-- Web app manifest -->
        <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">

        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename = 'css/style.css') }}"> 
        <script src="{{ url_for('static', filename = 'js/user.js') }}"></script>

    </head>

    <script>
        let appV = null
        let buckets = [{'name': 'WANDA-LOIS', 'id' : 0}, 
                        {'name': 'Bucket', 'id' : 1},
                        {'name': 'Bucket', 'id' : 2},
                        {'name': 'Bucket', 'id' : 3},
                        {'name': 'Bucket', 'id' : 4}]
        Vue.component('bucket-button', {
            delimiters : ['[[', ']]'],
            props: ['bucket'],
            template: '<div class="bucket-button">[[bucket.name]] <strong>[[bucket.id]]</strong></div>'
        })

        Vue.directive("swipe", {
            bind: function(el, binding) {
                if (typeof binding.value === "function") {
                    const mc = new Hammer(el);
                    mc.get("swipe").set({ direction: Hammer.DIRECTION_VERTICAL });
                    mc.on("swipe", binding.value);
                }
            }
        });

        function animateOverlay(finalTop, dist = 0) 
        {
            $('#bottom-overlay').animate(
                {top : ($(document.body).height()*finalTop + dist)}, 
                {duration: 150, complete: ()=>{
                    $('#bottom-overlay').animate(
                        {top : finalTop*100 + '%'},
                        {duration: 50, complete: ()=>{        
                            $('#tab-line-c').animate(
                                {padding : finalTop == 0.5 ? '5%' : 
                                    ($(document.body).height()-$('#bottom-overlay').position().top)/2},
                                250
                            )
                        }})
                }
            })
        }

        document.addEventListener('DOMContentLoaded', e=>{
            appV = new Vue({
                el: '#app',
                delimiters : ['[[', ']]'],
                data: {
                    id : 'b\'not213243hhhas2aRealID',
                    messages: null,
                    buckets: buckets
                },
                methods: {
                    overlaySwipe(event) {
                        if (!event.isFinal) return

                        var finalTop = null
                        if (event.direction == 16)
                            finalTop = 0.9
                        else
                            finalTop = 0.5

                        var dist = (event.direction == 16? 1 : -1)*Math.abs(event.velocityY) *5
                        animateOverlay(finalTop, dist)
                    }
                }
            })

            if ('serviceWorker' in navigator) {
                navigator.serviceWorker
                .register('./sw.js')
                .then(function(registration) {
                    console.log('Service Worker Registered!');
                    return registration;
                })
                .catch(function(err) {
                    console.error('Unable to register service worker.', err);
                });
            }

            vIDAjax()
        });

    </script>

    <body>
        
        <div id="app">
            <div id='welcome-text'><strong>Welcome,</strong><br>
                <span style="
                    font-size: 2vh;
                    width: 100%;
                    overflow: hidden;
                ">
                Your id has been generated as <br> <div style="
                    white-space: nowrap;
                    text-overflow: ellipsis;
                    overflow: hidden;
                    width: 70%;
                    margin-left: auto;
                    margin-right: auto;
                ">[[ id ]]</div></span>
            </div>

            <div id="bottom-overlay" >
                <div id="tab-line-c" v-swipe="overlaySwipe" style="width: 100%;height: 3%;padding: 5%;box-sizing: border-box;">
                    <div class="tab-line"></div>
                </div>
                <div style="display: flex; flex-direction: column; justify-content: space-between;">
                    <bucket-button
                        v-for="b in buckets"
                        v-bind:bucket="b"
                        v-bind:key="b.id"
                        v-bind:onclick="'window.location=\'/chat?bucket='+b.id+'\''">
                    </bucket-button>

                </div>
                <div style="margin:8%;font-size: 3vh;text-align: center;">
                    <div style="font-weight: bolder;">Who's online</div>
                    <div>
                        <li>John - b0</li>
                        <li>Jake - b3</li>
                    </div>
                </div>
            </div>
        </div>
        
        <script>
            // if (prompt("Password", "") != "HELLO")
            //     window.location = '/fuck'
        </script>
    </body>

</html>
